<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>earth_size - NeoFermi Notebook</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <style>

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #1e1e1e;
  color: #d4d4d4;
  line-height: 1.6;
  padding: 20px;
}

.neofermi-notebook {
  max-width: 800px;
  margin: 0 auto;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
  color: #ffffff;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  font-weight: 600;
}

h1 { font-size: 2em; border-bottom: 1px solid #3e3e3e; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; }
h3 { font-size: 1.25em; }

p {
  margin: 1em 0;
}

a {
  color: #4ec9b0;
}

ul, ol {
  margin: 1em 0;
  padding-left: 2em;
}

blockquote {
  border-left: 4px solid #4ec9b0;
  padding-left: 1em;
  margin: 1em 0;
  color: #888;
}

/* Code blocks (non-NeoFermi) */
pre {
  background: #252525;
  border-radius: 6px;
  padding: 12px;
  overflow-x: auto;
  margin: 1em 0;
}

code {
  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
  font-size: 0.9em;
}

p code, li code {
  background: #252525;
  padding: 2px 6px;
  border-radius: 3px;
}

/* NeoFermi cells */
.nf-cell {
  background: #252525;
  border-radius: 8px;
  margin: 1em 0;
  border: 1px solid #3e3e3e;
  overflow: hidden;
}

.nf-code {
  background: #2d2d2d;
  margin: 0;
  padding: 12px;
  border-bottom: 1px solid #3e3e3e;
  border-radius: 0;
}

.nf-code code {
  color: #ce9178;
}

.nf-result {
  padding: 12px;
  background: rgba(206, 145, 120, 0.08);
}

.nf-stats {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.nf-stat {
  font-size: 0.9em;
}

.nf-stat strong {
  color: #4ec9b0;
}

.nf-scalar {
  color: #4ec9b0;
  font-weight: 500;
}

.nf-dim {
  color: #888;
  font-style: italic;
  font-size: 0.9em;
}

.nf-error {
  padding: 12px;
  background: rgba(244, 135, 113, 0.1);
  color: #f48771;
  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
  font-size: 0.85em;
}

.nf-viz {
  padding: 12px;
  display: flex;
  justify-content: center;
}

.nf-viz canvas {
  border-radius: 4px;
}

/* Tables */
table {
  border-collapse: collapse;
  margin: 1em 0;
  width: 100%;
}

th, td {
  border: 1px solid #3e3e3e;
  padding: 8px 12px;
  text-align: left;
}

th {
  background: #2d2d2d;
  font-weight: 600;
}

/* Horizontal rule */
hr {
  border: none;
  border-top: 1px solid #3e3e3e;
  margin: 2em 0;
}

/* Images */
img {
  max-width: 100%;
  border-radius: 4px;
}

  </style>
</head>
<body>
  <article class="neofermi-notebook">
<h1>Estimating the Earth's Circumference</h1>
<p>A classic Fermi estimation using what we know about time zones and the United States.</p>
<h2>What We Know</h2>
<p>The Earth has 24 time zones (one for each hour). The continental US spans about 4 of these time zones (Eastern, Central, Mountain, Pacific). And we roughly know how wide the US is.</p>
<h2>The Estimation</h2>
<h3>US Width</h3>
<p>The continental US is roughly 2000-3000 miles wide:</p>
<div class="nf-cell">
<pre class="nf-code"><code>us_width = 2000 to 3000 mile</code></pre>
<div class="nf-result"><div class="nf-stats">
<span class="nf-stat">Mean: <strong>2494</strong> mile <span class="nf-dim">{length}</span></span>
<span class="nf-stat">Median: 2442 mile</span>
<span class="nf-stat">[68% CI]: [1997, 2993] mile</span>
</div></div><div class="nf-viz" data-samples="[1645.3655444151464,1826.5908082626167,1934.5829383870425,2020.749157447308,2097.546251155106,2163.299157167914,2230.4647492321387,2288.508314620897,2350.1026510383895,2410.833347376121,2472.0152901644506,2541.295968240401,2608.79646832383,2680.581229701398,2759.440180957027,2849.341313612635,2955.1975955436546,3090.047434186091,3273.5305902187274,3613.3241517799834]" data-unit="mile" data-min="1094.6787029856503" data-max="5306.819866689571"></div>
</div>
<h3>Time Zone Width</h3>
<p>The US spans about 4 time zones, so each time zone is:</p>
<div class="nf-cell">
<pre class="nf-code"><code>us_timezones = 3 to 5
timezone_width = us_width / us_timezones</code></pre>
<div class="nf-result"><div class="nf-stats">
<span class="nf-stat">Mean: <strong>663</strong> mile <span class="nf-dim">{length}</span></span>
<span class="nf-stat">Median: 631 mile</span>
<span class="nf-stat">[68% CI]: [457, 866] mile</span>
</div></div><div class="nf-viz" data-samples="[332.96491601973366,394.5812147352971,435.98916594213716,465.9715034535653,492.98496774821865,519.0721212474197,544.4342335043603,568.5711725844435,593.4961803620046,618.3792568116888,643.5091414349309,670.5618377385177,699.299529063889,729.7643081614985,762.9307845333406,802.9110524923435,849.9086392917897,911.9057218882793,996.1661786018053,1176.938089774403]" data-unit="mile" data-min="160.91661651449792" data-max="2220.247538396576"></div>
</div>
<h3>Earth's Circumference</h3>
<p>With 24 time zones around the Earth:</p>
<div class="nf-cell">
<pre class="nf-code"><code>num_timezones = 24
earth_circumference = timezone_width * num_timezones</code></pre>
<div class="nf-result"><div class="nf-stats">
<span class="nf-stat">Mean: <strong>15915</strong> mile <span class="nf-dim">{length}</span></span>
<span class="nf-stat">Median: 15137 mile</span>
<span class="nf-stat">[68% CI]: [10975, 20782] mile</span>
</div></div><div class="nf-viz" data-samples="[7991.157984473608,9469.94915364713,10463.739982611292,11183.316082885567,11831.639225957248,12457.730909938073,13066.42160410465,13645.708142026644,14243.90832868811,14841.102163480533,15444.219394438343,16093.484105724427,16783.188697533336,17514.343395875963,18310.338828800173,19269.865259816244,20397.80734300295,21885.737325318703,23907.988286443328,28246.514154585668]" data-unit="mile" data-min="3861.99879634795" data-max="53285.94092151783"></div>
</div>
<h3>Convert to Kilometers</h3>
<div class="nf-cell">
<pre class="nf-code"><code>earth_circumference as km</code></pre>
<div class="nf-result"><div class="nf-stats">
<span class="nf-stat">Mean: <strong>25613</strong> km <span class="nf-dim">{length}</span></span>
<span class="nf-stat">Median: 24360 km</span>
<span class="nf-stat">[68% CI]: [17663, 33445] km</span>
</div></div><div class="nf-viz" data-samples="[12860.522155364695,15240.40585072709,16839.75715857559,17997.802638095392,19041.17759845894,20048.77449352338,21028.367210036195,21960.63852412173,22923.34840532424,23884.438720184415,24855.061817122983,25899.952084642973,27009.924031243092,28186.60345809261,29467.63393209659,31011.842036693717,32827.08886061774,35221.6800500777,38476.177500857855,45458.35807559752]" data-unit="km" data-min="6215.284590909795" data-max="85755.4093063992"></div>
</div>
<h2>Result</h2>
<p>The Earth's circumference is approximately <strong>15915 mile</strong> or <strong>${earth_circumference_km}</strong>.</p>
<p>The actual value is about 24,901 miles (40,075 km) - let's see how close our estimate is!</p>
  </article>
  <script type="module">

// Nice number for tick marks (1, 2, 5, 10, 20, 50, etc.)
function niceNum(x, round) {
  if (x === 0) return 0;
  const exp = Math.floor(Math.log10(Math.abs(x)));
  const f = x / Math.pow(10, exp);
  let nf;
  if (round) {
    nf = f < 1.5 ? 1 : f < 3 ? 2 : f < 7 ? 5 : 10;
  } else {
    nf = f <= 1 ? 1 : f <= 2 ? 2 : f <= 5 ? 5 : 10;
  }
  return nf * Math.pow(10, exp);
}

function generateLinearTicks(min, max, maxTicks = 5) {
  const range = niceNum(max - min, false);
  const spacing = niceNum(range / (maxTicks - 1), true);
  const niceMin = Math.floor(min / spacing) * spacing;
  const niceMax = Math.ceil(max / spacing) * spacing;
  const ticks = [];
  for (let t = niceMin; t <= niceMax + spacing * 0.5; t += spacing) {
    if (t >= min && t <= max) ticks.push(t);
  }
  return ticks;
}

function generateLogTicks(min, max) {
  if (min <= 0 || max <= 0) return [];
  const minExp = Math.floor(Math.log10(min));
  const maxExp = Math.ceil(Math.log10(max));
  const ticks = [];
  for (let exp = minExp; exp <= maxExp; exp++) {
    const tick = Math.pow(10, exp);
    if (tick >= min * 0.99 && tick <= max * 1.01) ticks.push(tick);
  }
  if (ticks.length <= 2) {
    const allTicks = [];
    for (let exp = minExp; exp <= maxExp; exp++) {
      for (const mult of [1, 2, 5]) {
        const tick = mult * Math.pow(10, exp);
        if (tick >= min * 0.99 && tick <= max * 1.01) allTicks.push(tick);
      }
    }
    return allTicks;
  }
  return ticks;
}

function formatNum(n) {
  if (n === 0) return '0';
  const abs = Math.abs(n);
  if (abs >= 10000 || abs < 0.001) return n.toExponential(0);
  if (Math.abs(n - Math.round(n)) < 0.001) return Math.round(n).toString();
  if (abs >= 100) return n.toFixed(0);
  if (abs >= 10) return n.toFixed(1);
  if (abs >= 1) return n.toFixed(2);
  return n.toPrecision(2);
}

function renderDotplots() {
  document.querySelectorAll('.nf-viz').forEach(el => {
    const samples = JSON.parse(el.dataset.samples || '[]');
    const unit = el.dataset.unit || '';
    const min = parseFloat(el.dataset.min);
    const max = parseFloat(el.dataset.max);

    if (samples.length === 0) return;

    const dpr = window.devicePixelRatio || 1;
    const displayWidth = 280;
    const displayHeight = 90;

    const canvas = document.createElement('canvas');
    canvas.width = displayWidth * dpr;
    canvas.height = displayHeight * dpr;
    canvas.style.width = displayWidth + 'px';
    canvas.style.height = displayHeight + 'px';
    el.appendChild(canvas);

    const ctx = canvas.getContext('2d');
    ctx.scale(dpr, dpr);

    const width = displayWidth;
    const height = displayHeight;
    const dotRadius = 5;
    const padding = 25;
    const axisHeight = 20;

    // Background
    ctx.fillStyle = '#1a1a2e';
    ctx.fillRect(0, 0, width, height);

    const useLog = min > 0 && max > 0 && (max / min) > 100;
    const toX = useLog
      ? v => padding + ((Math.log10(v) - Math.log10(min)) / (Math.log10(max) - Math.log10(min))) * (width - 2 * padding)
      : v => padding + ((v - min) / (max - min)) * (width - 2 * padding);

    // Generate nice ticks
    const ticks = useLog ? generateLogTicks(min, max) : generateLinearTicks(min, max, 5);

    // Bin dots by X position to stack them vertically
    const binWidth = dotRadius * 2.2;
    const bins = new Map();
    samples.forEach(v => {
      const x = toX(v);
      const binIndex = Math.round(x / binWidth);
      if (!bins.has(binIndex)) bins.set(binIndex, []);
      bins.get(binIndex).push(v);
    });

    // Draw stacked dots from bottom up, all dots in a bin share the same X
    const baseY = height - axisHeight - dotRadius - 2;
    ctx.fillStyle = 'rgba(99, 102, 241, 0.85)';
    bins.forEach((dots, binIndex) => {
      const x = binIndex * binWidth; // Use bin center, not individual x
      dots.forEach((v, i) => {
        const y = baseY - i * (dotRadius * 2.2);
        if (y > dotRadius) {
          ctx.beginPath();
          ctx.arc(x, y, dotRadius, 0, Math.PI * 2);
          ctx.fill();
        }
      });
    });

    // Draw axis line
    const axisY = height - axisHeight;
    ctx.strokeStyle = '#555';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding, axisY);
    ctx.lineTo(width - padding, axisY);
    ctx.stroke();

    // Draw ticks and labels
    ctx.fillStyle = '#999';
    ctx.font = '10px -apple-system, sans-serif';
    ctx.textAlign = 'center';
    ticks.forEach(tick => {
      const x = toX(tick);
      // Tick mark
      ctx.beginPath();
      ctx.moveTo(x, axisY);
      ctx.lineTo(x, axisY + 4);
      ctx.stroke();
      // Label
      ctx.fillText(formatNum(tick), x, axisY + 14);
    });

    // Unit label on right
    if (unit) {
      ctx.fillStyle = '#777';
      ctx.textAlign = 'right';
      ctx.fillText(unit, width - 5, axisY + 14);
    }
  });
}

renderDotplots();

  </script>
</body>
</html>